<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoDiagnose Classic | Expert Car Troubleshooting System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --navy: #2c3e50;
            --slate: #4a5568;
            --light-gray: #f8f9fa;
            --white: #ffffff;
            --accent: #3498db;
            --accent-dark: #2980b9;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
            color: var(--navy);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 40px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo-icon {
            background: var(--accent);
            width: 70px;
            height: 70px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .logo-icon i {
            font-size: 32px;
            color: white;
        }

        .logo-text h1 {
            font-family: 'Merriweather', serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--navy);
            margin-bottom: 8px;
        }

        .logo-text p {
            color: var(--slate);
            font-size: 1.1rem;
            font-weight: 400;
        }

        .tagline {
            font-size: 1.2rem;
            color: var(--slate);
            max-width: 700px;
            margin: 0 auto 40px;
            line-height: 1.7;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            padding: 20px 30px;
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            min-width: 140px;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--slate);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1100px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--border);
            height: 100%;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--navy);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title i {
            color: var(--accent);
            font-size: 1.3rem;
        }

        .badge {
            background: var(--accent);
            color: var(--white);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Knowledge Base */
        .rules-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .rule-card {
            background: var(--light-gray);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--accent);
            transition: all 0.3s ease;
        }

        .rule-card:hover {
            background: #edf2f7;
            transform: translateX(4px);
        }

        .rule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .rule-id {
            background: var(--accent);
            color: var(--white);
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .rule-priority {
            color: var(--slate);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .rule-body {
            font-family: 'Monaco', 'Courier New', monospace;
            background: var(--white);
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            border: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .rule-conditions {
            color: var(--danger);
            font-weight: 600;
        }

        .rule-conclusion {
            color: var(--success);
            font-weight: 700;
            margin-top: 8px;
            display: block;
        }

        .rule-desc {
            color: var(--slate);
            font-size: 0.85rem;
            margin-top: 12px;
            line-height: 1.5;
        }

        /* Symptoms Selector */
        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .symptom-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--light-gray);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .symptom-item:hover {
            border-color: var(--accent);
            background: var(--white);
        }

        .symptom-item input {
            width: 20px;
            height: 20px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .symptom-label {
            flex: 1;
            font-weight: 500;
            color: var(--navy);
            cursor: pointer;
            font-size: 0.95rem;
        }

        .symptom-icon {
            color: var(--accent);
            font-size: 1.2rem;
        }

        .selected-symptoms-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            min-height: 70px;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 10px;
            border: 2px dashed #c5d9f1;
        }

        .selected-badge {
            background: var(--accent);
            color: var(--white);
            padding: 8px 18px;
            border-radius: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: fadeIn 0.3s ease;
            font-size: 0.9rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 30px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 190px;
        }

        .btn-primary {
            background: var(--accent);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.2);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--navy);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.2);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.2);
        }

        /* Inference Log */
        .inference-log {
            max-height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: var(--light-gray);
            border-radius: 12px;
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        .log-entry {
            padding: 20px;
            margin-bottom: 15px;
            background: var(--white);
            border-radius: 10px;
            border-left: 4px solid var(--accent);
            animation: slideIn 0.5s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .log-step {
            font-weight: 700;
            color: var(--navy);
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .log-rule {
            background: #e3f2fd;
            color: var(--accent);
            padding: 4px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .log-fact {
            background: #e8f5e9;
            color: var(--success);
            padding: 4px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .log-desc {
            color: var(--slate);
            margin-top: 10px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Results */
        .results-container {
            margin-top: 40px;
        }

        .diagnosis-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            border: 2px solid var(--accent);
            box-shadow: var(--shadow-lg);
        }

        .diagnosis-title {
            font-size: 1.8rem;
            color: var(--navy);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .diagnosis-title i {
            color: var(--accent);
            font-size: 2rem;
        }

        .diagnosis-result {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--accent);
            margin: 25px 0;
            position: relative;
            display: inline-block;
            padding: 0 20px;
        }

        .diagnosis-result::before,
        .diagnosis-result::after {
            content: '•';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            font-size: 2rem;
            opacity: 0.5;
        }

        .diagnosis-result::before {
            left: 0;
        }

        .diagnosis-result::after {
            right: 0;
        }

        .solution-card {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid var(--success);
            box-shadow: var(--shadow);
        }

        .solution-title {
            font-size: 1.3rem;
            color: var(--navy);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }

        .solution-title i {
            color: var(--success);
        }

        .solution-steps {
            list-style: none;
            padding-left: 0;
        }

        .solution-steps li {
            padding: 14px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        .solution-steps li:last-child {
            border-bottom: none;
        }

        .step-number {
            background: var(--accent);
            color: var(--white);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .solution-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
            color: var(--slate);
            font-size: 0.95rem;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--slate);
            margin-top: 60px;
            border-top: 2px solid var(--border);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: var(--slate);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .footer-links a:hover {
            color: var(--accent);
        }

        .copyright {
            font-size: 0.9rem;
            margin-top: 25px;
            color: var(--slate);
        }

        .copyright p:first-child {
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            margin: 20px 0;
        }

        .loading i {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 20px 10px;
            }
            
            .logo-text h1 {
                font-size: 2rem;
            }
            
            .btn {
                min-width: 100%;
            }
            
            .stats {
                gap: 15px;
            }
            
            .stat {
                min-width: 120px;
                padding: 15px 20px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .diagnosis-result {
                font-size: 2.2rem;
            }
            
            .rules-container {
                grid-template-columns: 1fr;
            }
            
            .symptoms-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-car-mechanic"></i>
                </div>
                <div class="logo-text">
                    <h1>AutoDiagnose Classic</h1>
                    <p>Expert Car Troubleshooting System</p>
                </div>
            </div>
            
            <p class="tagline">
                An intelligent rule-based expert system using forward chaining inference to diagnose 
                vehicle issues with precision. Select symptoms below to begin analysis.
            </p>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="ruleCount">15</div>
                    <div class="stat-label">Expert Rules</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="symptomCount">17</div>
                    <div class="stat-label">Symptoms</div>
                </div>
                <div class="stat">
                    <div class="stat-value">95%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
                <div class="stat">
                    <div class="stat-value">&lt;2s</div>
                    <div class="stat-label">Diagnosis Time</div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-layout">
            <!-- Left Column: Knowledge Base -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-brain"></i> Knowledge Base</h2>
                    <span class="badge" id="rulesBadge">15 Expert Rules</span>
                </div>
                <div class="rules-container" id="rulesList">
                    <!-- Rules will be populated by JavaScript -->
                </div>
            </div>

            <!-- Right Column: Symptoms & Diagnosis -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-stethoscope"></i> Symptom Assessment</h2>
                    <span class="badge">Interactive</span>
                </div>
                
                <p style="margin-bottom: 20px; color: var(--slate);">
                    Select all symptoms that apply to your vehicle:
                </p>
                
                <div class="symptoms-grid" id="factsInput">
                    <!-- Symptoms checkboxes will be populated by JavaScript -->
                </div>
                
                <h3 style="margin-top: 30px; color: var(--navy);">Selected Symptoms</h3>
                <div class="selected-symptoms-area" id="selectedFacts">
                    <p style="color: var(--slate); text-align: center; width: 100%; font-style: italic;">
                        No symptoms selected yet. Check symptoms above to add them here.
                    </p>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="startDiagnosisBtn">
                        <i class="fas fa-play-circle"></i> Start Diagnosis
                    </button>
                    <button class="btn btn-danger" id="clearAllBtn">
                        <i class="fas fa-redo"></i> Clear All
                    </button>
                    <button class="btn btn-success" id="loadExampleBtn">
                        <i class="fas fa-vial"></i> Load Example
                    </button>
                </div>

                <!-- Loading Animation -->
                <div class="loading" id="loadingAnimation">
                    <i class="fas fa-spinner"></i>
                    <p>Running forward chaining inference...</p>
                </div>
            </div>
        </div>

        <!-- Inference Process -->
        <div class="card" style="margin-top: 30px;">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-project-diagram"></i> Inference Process</h2>
                <span class="badge">Forward Chaining</span>
            </div>
            <div class="inference-log" id="inferenceLog">
                <div class="log-entry" style="border-color: var(--slate);">
                    <div class="log-step"><i class="fas fa-info-circle"></i> System Ready</div>
                    <p>Select symptoms and click "Start Diagnosis" to begin the inference process.</p>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-container" id="resultsContainer">
            <!-- Results will be populated here -->
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-links">
                <a href="#"><i class="fas fa-book"></i> Documentation</a>
                <a href="#"><i class="fas fa-database"></i> Rule Library</a>
                <a href="#"><i class="fas fa-chart-bar"></i> Accuracy Report</a>
                <a href="#"><i class="fas fa-question-circle"></i> Help Center</a>
                <a href="#"><i class="fas fa-envelope"></i> Contact Support</a>
            </div>
            <div class="copyright">
                <p>© 2024 AutoDiagnose Classic | Expert System | Forward Chaining Inference Engine</p>
                <p style="margin-top: 10px; font-size: 0.85rem;">
                    This system uses forward chaining inference with 15 diagnostic rules for vehicle troubleshooting.
                </p>
            </div>
        </footer>
    </div>

    <script>
        // ========== KNOWLEDGE BASE ==========
        const rules = [
            {
                id: "R1",
                conditions: ["engine_wont_start", "no_cranking_sound"],
                conclusion: "dead_battery",
                description: "No cranking sound indicates complete battery failure",
                priority: "Critical",
                confidence: "95%"
            },
            {
                id: "R2",
                conditions: ["engine_wont_start", "cranking_sound", "no_fuel_smell"],
                conclusion: "fuel_system_issue",
                description: "Normal cranking without fuel smell points to fuel system problems",
                priority: "High",
                confidence: "85%"
            },
            {
                id: "R3",
                conditions: ["engine_wont_start", "cranking_sound", "fuel_smell"],
                conclusion: "ignition_system_issue",
                description: "Cranking with fuel smell indicates ignition problems",
                priority: "High",
                confidence: "80%"
            },
            {
                id: "R4",
                conditions: ["engine_misfires", "rough_idle"],
                conclusion: "spark_plugs_fouled",
                description: "Misfires with rough idle suggest fouled spark plugs",
                priority: "Medium",
                confidence: "75%"
            },
            {
                id: "R5",
                conditions: ["overheating", "coolant_leak"],
                conclusion: "cooling_system_leak",
                description: "Overheating with visible coolant leak indicates cooling system failure",
                priority: "Critical",
                confidence: "90%"
            },
            {
                id: "R6",
                conditions: ["overheating", "fan_not_working"],
                conclusion: "radiator_fan_fault",
                description: "Overheating without fan operation suggests fan failure",
                priority: "High",
                confidence: "85%"
            },
            {
                id: "R7",
                conditions: ["squealing_sound", "braking"],
                conclusion: "worn_brake_pads",
                description: "Squealing during braking indicates brake pads are worn",
                priority: "High",
                confidence: "95%"
            },
            {
                id: "R8",
                conditions: ["grinding_sound", "braking"],
                conclusion: "worn_brake_rotors",
                description: "Grinding noise suggests severely worn brake rotors",
                priority: "Critical",
                confidence: "90%"
            },
            {
                id: "R9",
                conditions: ["soft_brake_pedal", "brake_warning_light"],
                conclusion: "brake_fluid_leak",
                description: "Soft pedal with warning light indicates brake fluid leak",
                priority: "Critical",
                confidence: "88%"
            },
            {
                id: "R10",
                conditions: ["dim_lights", "electrical_issues"],
                conclusion: "alternator_problem",
                description: "Dim lights with electrical issues suggest alternator failure",
                priority: "High",
                confidence: "82%"
            },
            {
                id: "R11",
                conditions: ["battery_warning_light", "electrical_issues"],
                conclusion: "charging_system_fault",
                description: "Battery light with electrical problems indicates charging system fault",
                priority: "High",
                confidence: "85%"
            },
            {
                id: "R12",
                conditions: ["delayed_shifting", "transmission_slipping"],
                conclusion: "low_transmission_fluid",
                description: "Delayed shifting with slipping indicates low transmission fluid",
                priority: "Medium",
                confidence: "78%"
            },
            {
                id: "R13",
                conditions: ["burning_smell", "transmission_slipping"],
                conclusion: "overheating_transmission",
                description: "Burning smell with slipping suggests transmission overheating",
                priority: "Critical",
                confidence: "90%"
            },
            {
                id: "R14",
                conditions: ["check_engine_light", "poor_fuel_economy"],
                conclusion: "oxygen_sensor_fault",
                description: "Check engine light with poor fuel economy suggests oxygen sensor failure",
                priority: "Medium",
                confidence: "75%"
            },
            {
                id: "R15",
                conditions: ["excessive_exhaust_smoke", "blue_smoke"],
                conclusion: "oil_burning",
                description: "Blue exhaust smoke indicates engine burning oil",
                priority: "High",
                confidence: "88%"
            }
        ];

        // Symptoms/All Facts
        const allFacts = [
            {id: "engine_wont_start", label: "Engine won't start", icon: "fas fa-engine"},
            {id: "engine_misfires", label: "Engine misfires", icon: "fas fa-car-burst"},
            {id: "rough_idle", label: "Rough idle", icon: "fas fa-vihara"},
            {id: "overheating", label: "Engine overheats", icon: "fas fa-temperature-high"},
            {id: "squealing_sound", label: "Squealing sound from brakes", icon: "fas fa-volume-up"},
            {id: "grinding_sound", label: "Grinding sound", icon: "fas fa-cogs"},
            {id: "braking", label: "Sound when braking", icon: "fas fa-braille"},
            {id: "soft_brake_pedal", label: "Soft brake pedal", icon: "fas fa-pedal-alt"},
            {id: "brake_warning_light", label: "Brake warning light", icon: "fas fa-exclamation-triangle"},
            {id: "no_cranking_sound", label: "No cranking sound", icon: "fas fa-volume-mute"},
            {id: "cranking_sound", label: "Engine cranks, won't start", icon: "fas fa-play-circle"},
            {id: "fuel_smell", label: "Fuel smell", icon: "fas fa-gas-pump"},
            {id: "no_fuel_smell", label: "No fuel smell", icon: "fas fa-wind"},
            {id: "coolant_leak", label: "Coolant leak", icon: "fas fa-tint-slash"},
            {id: "fan_not_working", label: "Fan not working", icon: "fas fa-fan"},
            {id: "dim_lights", label: "Dim lights", icon: "fas fa-lightbulb"},
            {id: "electrical_issues", label: "Electrical issues", icon: "fas fa-bolt"},
            {id: "battery_warning_light", label: "Battery warning light", icon: "fas fa-car-battery"},
            {id: "delayed_shifting", label: "Delayed shifting", icon: "fas fa-cog"},
            {id: "transmission_slipping", label: "Transmission slipping", icon: "fas fa-sliders-h"},
            {id: "burning_smell", label: "Burning smell", icon: "fas fa-fire"},
            {id: "check_engine_light", label: "Check engine light", icon: "fas fa-engine-warning"},
            {id: "poor_fuel_economy", label: "Poor fuel economy", icon: "fas fa-gas-pump"},
            {id: "excessive_exhaust_smoke", label: "Excessive exhaust smoke", icon: "fas fa-smog"},
            {id: "blue_smoke", label: "Blue smoke", icon: "fas fa-smoke"},
            {id: "white_smoke", label: "White smoke", icon: "fas fa-cloud"}
        ];

        // Solutions for conclusions
        const solutions = {
            "dead_battery": {
                title: "Battery Replacement",
                severity: "Critical",
                steps: [
                    "Test battery voltage (should be 12.6V or higher)",
                    "Jump start vehicle if voltage is below 11.8V",
                    "Clean battery terminals and connections",
                    "Replace battery if unable to hold charge",
                    "Test alternator output (should be 13.5-14.5V)"
                ],
                estimatedCost: "$150-$300",
                time: "30-60 minutes"
            },
            "fuel_system_issue": {
                title: "Fuel System Diagnostics",
                severity: "High",
                steps: [
                    "Check fuel pump fuse and relay",
                    "Test fuel pressure at fuel rail",
                    "Listen for pump priming sound when key is turned",
                    "Inspect fuel filter for clogs",
                    "Test fuel injectors"
                ],
                estimatedCost: "$200-$600",
                time: "2-3 hours"
            },
            "ignition_system_issue": {
                title: "Ignition System Repair",
                severity: "High",
                steps: [
                    "Check spark plugs for wear or fouling",
                    "Test ignition coils with multimeter",
                    "Inspect distributor cap and rotor if applicable",
                    "Check ignition timing",
                    "Test crankshaft position sensor"
                ],
                estimatedCost: "$150-$500",
                time: "2-4 hours"
            },
            "spark_plugs_fouled": {
                title: "Spark Plug Replacement",
                severity: "Medium",
                steps: [
                    "Remove and inspect spark plugs",
                    "Check gap specification",
                    "Replace with OEM recommended plugs",
                    "Inspect ignition wires",
                    "Reset engine computer if needed"
                ],
                estimatedCost: "$100-$300",
                time: "1-2 hours"
            },
            "cooling_system_leak": {
                title: "Cooling System Repair",
                severity: "Critical",
                steps: [
                    "Pressure test cooling system",
                    "Identify leak source with UV dye",
                    "Replace damaged hoses or radiator",
                    "Refill with proper coolant mixture",
                    "Bleed air from cooling system"
                ],
                estimatedCost: "$200-$800",
                time: "2-6 hours"
            },
            "radiator_fan_fault": {
                title: "Radiator Fan Repair",
                severity: "High",
                steps: [
                    "Test fan motor with direct 12V power",
                    "Check fan relay and fuse",
                    "Test coolant temperature sensor",
                    "Replace faulty fan or relay",
                    "Verify proper operation at temperature"
                ],
                estimatedCost: "$150-$400",
                time: "1-2 hours"
            },
            "worn_brake_pads": {
                title: "Brake Pad Replacement",
                severity: "High",
                steps: [
                    "Remove wheels and inspect brake pads",
                    "Check rotor condition",
                    "Replace brake pads",
                    "Resurface rotors if necessary",
                    "Test brake performance"
                ],
                estimatedCost: "$150-$400",
                time: "1-2 hours"
            },
            "worn_brake_rotors": {
                title: "Brake Rotor Replacement",
                severity: "Critical",
                steps: [
                    "Measure rotor thickness",
                    "Check for warping or scoring",
                    "Replace worn rotors",
                    "Replace brake pads simultaneously",
                    "Bed-in new brakes properly"
                ],
                estimatedCost: "$300-$600",
                time: "2-3 hours"
            },
            "brake_fluid_leak": {
                title: "Brake System Leak Repair",
                severity: "Critical",
                steps: [
                    "Inspect brake lines for leaks",
                    "Check master cylinder",
                    "Inspect calipers and wheel cylinders",
                    "Repair or replace leaking components",
                    "Bleed brake system and refill fluid"
                ],
                estimatedCost: "$200-$500",
                time: "2-4 hours"
            },
            "alternator_problem": {
                title: "Alternator Replacement",
                severity: "High",
                steps: [
                    "Test alternator output voltage",
                    "Check drive belt tension",
                    "Inspect wiring connections",
                    "Replace faulty alternator",
                    "Test charging system after repair"
                ],
                estimatedCost: "$300-$700",
                time: "1-2 hours"
            }
        };

        // ========== INITIALIZE UI ==========
        function initializeUI() {
            // Display all rules in the knowledge base
            const rulesList = document.getElementById('rulesList');
            rules.forEach(rule => {
                const ruleCard = document.createElement('div');
                ruleCard.className = 'rule-card';
                ruleCard.innerHTML = `
                    <div class="rule-header">
                        <span class="rule-id">${rule.id}</span>
                        <span class="rule-priority">${rule.priority} Priority</span>
                    </div>
                    <div class="rule-body">
                        IF <span class="rule-conditions">${rule.conditions.join(' AND ')}</span><br>
                        THEN <span class="rule-conclusion">${rule.conclusion}</span>
                    </div>
                    <div class="rule-desc">${rule.description} (Confidence: ${rule.confidence})</div>
                `;
                rulesList.appendChild(ruleCard);
            });

            // Create symptom checkboxes
            const factsInput = document.getElementById('factsInput');
            allFacts.forEach(fact => {
                const symptomItem = document.createElement('div');
                symptomItem.className = 'symptom-item';
                symptomItem.innerHTML = `
                    <input type="checkbox" id="${fact.id}" value="${fact.id}">
                    <i class="${fact.icon} symptom-icon"></i>
                    <label for="${fact.id}" class="symptom-label">${fact.label}</label>
                `;
                factsInput.appendChild(symptomItem);
                
                // Add event listener to update selected facts display
                const checkbox = symptomItem.querySelector('input');
                checkbox.addEventListener('change', updateSelectedFacts);
            });
            
            // Update counts in UI
            document.getElementById('ruleCount').textContent = rules.length;
            document.getElementById('symptomCount').textContent = allFacts.length;
        }

        // ========== UPDATE SELECTED FACTS DISPLAY ==========
        function updateSelectedFacts() {
            const selectedFactsDiv = document.getElementById('selectedFacts');
            selectedFactsDiv.innerHTML = '';
            
            const selectedFacts = [];
            allFacts.forEach(fact => {
                const checkbox = document.getElementById(fact.id);
                if (checkbox && checkbox.checked) {
                    selectedFacts.push(fact.id);
                    const badge = document.createElement('div');
                    badge.className = 'selected-badge';
                    badge.innerHTML = `
                        <i class="${fact.icon}"></i>
                        ${fact.label}
                    `;
                    selectedFactsDiv.appendChild(badge);
                }
            });
            
            if (selectedFacts.length === 0) {
                selectedFactsDiv.innerHTML = '<p style="color: var(--slate); text-align: center; width: 100%; font-style: italic;">No symptoms selected yet. Check symptoms above to add them here.</p>';
            }
        }

        // ========== FORWARD CHAINING ALGORITHM ==========
        function runInference() {
            // Get selected facts
            const selectedFacts = [];
            allFacts.forEach(fact => {
                const checkbox = document.getElementById(fact.id);
                if (checkbox && checkbox.checked) {
                    selectedFacts.push(fact.id);
                }
            });

            if (selectedFacts.length === 0) {
                alert("Please select at least one symptom to begin diagnosis.");
                return;
            }

            // Show loading animation
            document.getElementById('loadingAnimation').style.display = 'block';
            
            // Clear and setup log
            const log = document.getElementById('inferenceLog');
            const resultsContainer = document.getElementById('resultsContainer');
            log.innerHTML = '';
            resultsContainer.innerHTML = '';

            // Start inference - show initial message
            log.innerHTML = `
                <div class="log-entry" style="border-color: var(--accent);">
                    <div class="log-step"><i class="fas fa-play"></i> Inference Started</div>
                    <p>Beginning forward chaining with ${selectedFacts.length} initial symptom(s)</p>
                </div>
            `;

            // Small delay to show the initial message
            setTimeout(() => {
                // Show initial facts
                const initialFactsText = selectedFacts.map(f => {
                    const factObj = allFacts.find(x => x.id === f);
                    return factObj ? factObj.label : f;
                }).join(', ');
                
                log.innerHTML += `
                    <div class="log-entry">
                        <div class="log-step">Step 2: Initial Facts</div>
                        <p>Detected symptoms: <span class="log-fact">${initialFactsText}</span></p>
                    </div>
                `;

                // Run forward chaining
                const inferenceResult = performForwardChaining(selectedFacts);
                
                // Hide loading animation
                document.getElementById('loadingAnimation').style.display = 'none';
                
                // Display final results
                displayConclusions(inferenceResult);
                
            }, 800);
        }

        // ========== PERFORM FORWARD CHAINING ==========
        function performForwardChaining(initialFacts) {
            const log = document.getElementById('inferenceLog');
            let allFacts = [...initialFacts];
            let firedRules = [];
            let iteration = 2; // Start from step 3 (after initial facts)
            let newFactsAdded = true;
            let maxIterations = 20; // Safety limit
            
            // Forward chaining loop
            while (newFactsAdded && maxIterations > 0) {
                newFactsAdded = false;
                
                // Check each rule
                for (const rule of rules) {
                    // Skip if rule already fired
                    if (firedRules.includes(rule.id)) continue;
                    
                    // Check if all conditions are met
                    const allConditionsMet = rule.conditions.every(condition => 
                        allFacts.includes(condition)
                    );
                    
                    if (allConditionsMet) {
                        // Fire the rule
                        firedRules.push(rule.id);
                        newFactsAdded = true;
                        iteration++;
                        
                        // Add conclusion to facts if not already present
                        if (!allFacts.includes(rule.conclusion)) {
                            allFacts.push(rule.conclusion);
                            
                            // Log the rule firing
                            const conditionsText = rule.conditions.map(c => {
                                const factObj = allFacts.find(f => f === c);
                                return factObj ? allFacts.find(f => f.id === c)?.label || c : c;
                            }).join(' AND ');
                            
                            log.innerHTML += `
                                <div class="log-entry">
                                    <div class="log-step">Step ${iteration}: Rule Fired <span class="log-rule">${rule.id}</span></div>
                                    <p>Applied: <strong>IF ${conditionsText} THEN ${rule.conclusion}</strong></p>
                                    <p class="log-desc">${rule.description}</p>
                                    <p>New fact inferred: <span class="log-fact">${rule.conclusion}</span></p>
                                </div>
                            `;
                            
                            // Scroll to bottom of log
                            log.scrollTop = log.scrollHeight;
                        }
                        
                        // Break to restart rule checking with new facts
                        break;
                    }
                }
                
                maxIterations--;
            }
            
            // Inference complete
            iteration++;
            log.innerHTML += `
                <div class="log-entry" style="border-color: var(--success);">
                    <div class="log-step"><i class="fas fa-flag-checkered"></i> Inference Complete</div>
                    <p>Processed ${firedRules.length} rules, ${allFacts.length} total facts inferred</p>
                    <p>Final facts: <span class="log-fact">${allFacts.join(', ')}</span></p>
                </div>
            `;
            
            // Scroll to bottom
            log.scrollTop = log.scrollHeight;
            
            return {
                allFacts: allFacts,
                firedRules: firedRules,
                initialFacts: initialFacts
            };
        }

        // ========== DISPLAY CONCLUSIONS ==========
        function displayConclusions(inferenceResult) {
            const resultsContainer = document.getElementById('resultsContainer');
            const { allFacts, initialFacts } = inferenceResult;
            
            // Filter out the initial symptoms to get only diagnostic conclusions
            const diagnosticFacts = allFacts.filter(fact => 
                !initialFacts.includes(fact) && 
                Object.keys(solutions).includes(fact)
            );

            if (diagnosticFacts.length === 0) {
                // No specific issues found
                resultsContainer.innerHTML = `
                    <div class="diagnosis-card">
                        <div class="diagnosis-title"><i class="fas fa-search"></i> Diagnosis Complete</div>
                        <div class="diagnosis-result">No Specific Issues Found</div>
                        <div class="solution-card">
                            <div class="solution-title"><i class="fas fa-lightbulb"></i> Recommended Action</div>
                            <ul class="solution-steps">
                                <li><span class="step-number">1</span> Check basic items: fuel level, battery connections, fuses</li>
                                <li><span class="step-number">2</span> Consider professional diagnostic scan if symptoms persist</li>
                                <li><span class="step-number">3</span> Review vehicle maintenance schedule</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else {
                // Issues found
                let resultsHTML = `
                    <div class="diagnosis-card">
                        <div class="diagnosis-title"><i class="fas fa-stethoscope"></i> DIAGNOSIS RESULTS</div>
                        <div class="diagnosis-result">${diagnosticFacts.length} Issue(s) Identified</div>
                `;

                diagnosticFacts.forEach(problem => {
                    const solution = solutions[problem];
                    if (!solution) return;
                    
                    const severityColor = 
                        solution.severity === 'Critical' ? 'var(--danger)' : 
                        solution.severity === 'High' ? 'var(--warning)' : 
                        'var(--success)';
                        
                    resultsHTML += `
                        <div class="solution-card">
                            <div class="solution-title">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-wrench"></i> ${solution.title}
                                </div>
                                <span style="background: ${severityColor}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">
                                    ${solution.severity} Priority
                                </span>
                            </div>
                            <div class="solution-meta">
                                <span><i class="fas fa-clock"></i> ${solution.time}</span>
                                <span><i class="fas fa-dollar-sign"></i> ${solution.estimatedCost}</span>
                            </div>
                            <ul class="solution-steps">
                    `;
                    
                    solution.steps.forEach((step, index) => {
                        resultsHTML += `
                            <li><span class="step-number">${index + 1}</span> ${step}</li>
                        `;
                    });
                    
                    resultsHTML += `
                            </ul>
                        </div>
                    `;
                });

                resultsHTML += `</div>`;
                resultsContainer.innerHTML = resultsHTML;
            }
            
            // Scroll to results
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // ========== UTILITY FUNCTIONS ==========
        function resetFacts() {
            allFacts.forEach(fact => {
                const checkbox = document.getElementById(fact.id);
                if (checkbox) checkbox.checked = false;
            });
            
            document.getElementById('inferenceLog').innerHTML = `
                <div class="log-entry" style="border-color: var(--slate);">
                    <div class="log-step"><i class="fas fa-info-circle"></i> System Ready</div>
                    <p>Select symptoms and click "Start Diagnosis" to begin the inference process.</p>
                </div>
            `;
            
            document.getElementById('resultsContainer').innerHTML = '';
            document.getElementById('loadingAnimation').style.display = 'none';
            updateSelectedFacts();
        }

        function loadExample() {
            resetFacts();
            
            // Set example: Squealing brakes (from your screenshot)
            document.getElementById('squealing_sound').checked = true;
            document.getElementById('braking').checked = true;
            
            updateSelectedFacts();
            
            // Update log to show example loaded
            const log = document.getElementById('inferenceLog');
            log.innerHTML = `
                <div class="log-entry" style="border-color: var(--warning);">
                    <div class="log-step"><i class="fas fa-vial"></i> Example Loaded</div>
                    <p>Loaded example symptoms: <span class="log-fact">Squealing sound from brakes, Sound occurs when braking</span></p>
                    <p class="log-desc">Click "Start Diagnosis" to analyze these symptoms.</p>
                </div>
            `;
            
            // Clear any previous results
            document.getElementById('resultsContainer').innerHTML = '';
        }

        // ========== EVENT LISTENERS ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize UI
            initializeUI();
            
            // Add event listeners to buttons
            document.getElementById('startDiagnosisBtn').addEventListener('click', runInference);
            document.getElementById('clearAllBtn').addEventListener('click', resetFacts);
            document.getElementById('loadExampleBtn').addEventListener('click', loadExample);
            
            // Update selected facts on page load
            updateSelectedFacts();
        });
    </script>
</body>
</html>
