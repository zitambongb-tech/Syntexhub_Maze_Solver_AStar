<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoDiagnose Classic | Expert Car Troubleshooting System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --navy: #2c3e50;
            --slate: #4a6572;
            --light-gray: #f8f9fa;
            --white: #ffffff;
            --accent: #3498db;
            --accent-dark: #2980b9;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--navy);
            color: white;
            padding: 25px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .logo-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo-header i {
            font-size: 2.5rem;
            color: var(--accent);
        }

        h1 {
            font-family: 'Merriweather', serif;
            font-size: 2.4rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-left: 55px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }

        .panel-header i {
            font-size: 1.5rem;
            color: var(--accent);
        }

        h2 {
            font-size: 1.8rem;
            color: var(--navy);
            font-weight: 600;
        }

        .symptoms-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }

        .symptom-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--light-gray);
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            transition: all 0.3s ease;
        }

        .symptom-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .symptom-item i {
            margin-right: 12px;
            color: var(--slate);
        }

        .control-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        button {
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-dark);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: var(--slate);
            color: white;
        }

        .btn-secondary:hover {
            background: #3a5061;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(74, 101, 114, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .inference-log {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }

        .log-entry {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            background: white;
            border-left: 4px solid var(--accent);
            font-size: 0.95rem;
        }

        .log-entry.step {
            border-left-color: var(--warning);
        }

        .log-entry.fact {
            border-left-color: var(--success);
        }

        .log-entry.complete {
            border-left-color: var(--navy);
            font-weight: 600;
        }

        .diagnosis-result {
            padding: 25px;
            background: linear-gradient(135deg, #2c3e50 0%, #4a6572 100%);
            color: white;
            border-radius: 12px;
            margin-top: 20px;
        }

        .diagnosis-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .diagnosis-header i {
            font-size: 2rem;
            color: #3498db;
        }

        .diagnosis-content {
            line-height: 1.6;
        }

        .issue-found {
            color: #e74c3c;
            font-weight: 700;
            font-size: 1.4rem;
            margin-bottom: 15px;
        }

        .no-issue {
            color: #2ecc71;
            font-weight: 700;
            font-size: 1.4rem;
            margin-bottom: 15px;
        }

        .recommendations {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .recommendations h3 {
            margin-bottom: 15px;
            color: #3498db;
        }

        .recommendations ol {
            padding-left: 20px;
        }

        .recommendations li {
            margin-bottom: 10px;
            padding-left: 10px;
        }

        .symptom-checkbox {
            margin-right: 15px;
            transform: scale(1.2);
            cursor: pointer;
        }

        .symptom-label {
            flex-grow: 1;
            cursor: pointer;
        }

        .symptom-item.selected {
            background: #e3f2fd;
            border-left-color: var(--success);
        }

        .clearfix::after {
            content: "";
            clear: both;
            display: table;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--slate);
            font-size: 0.9rem;
            border-top: 1px solid #e9ecef;
            margin-top: 30px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: var(--slate);
        }

        .rules-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
            border-left: 4px solid var(--warning);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-header">
                <i class="fas fa-car-mechanic"></i>
                <div>
                    <h1>AutoDiagnose Classic</h1>
                    <p class="tagline">Expert Car Troubleshooting System using Forward Chaining</p>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Symptoms Panel -->
            <div class="panel">
                <div class="panel-header">
                    <i class="fas fa-clipboard-list"></i>
                    <h2>Selected Symptoms</h2>
                </div>
                
                <div class="symptoms-list" id="symptomsList">
                    <!-- Symptoms will be added here dynamically -->
                </div>

                <div class="control-buttons">
                    <button class="btn-primary" id="startDiagnosisBtn">
                        <i class="fas fa-play-circle"></i> Start Diagnosis
                    </button>
                    <button class="btn-danger" id="clearAllBtn">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                    <button class="btn-secondary" id="loadExampleBtn">
                        <i class="fas fa-file-import"></i> Load Example
                    </button>
                </div>

                <div class="rules-info">
                    <strong><i class="fas fa-info-circle"></i> Knowledge Base:</strong> 
                    The system contains 15 diagnostic rules covering common car issues like engine problems, brake issues, electrical faults, and more.
                </div>
            </div>

            <!-- Inference Panel -->
            <div class="panel">
                <div class="panel-header">
                    <i class="fas fa-cogs"></i>
                    <h2>Inference Process</h2>
                </div>
                
                <div class="loading" id="inferenceLoading">
                    <i class="fas fa-spinner fa-spin"></i> Processing inference...
                </div>
                
                <div class="inference-log" id="inferenceLog">
                    <!-- Inference steps will be added here -->
                    <div class="log-entry complete">
                        <strong>System Ready</strong><br>
                        Waiting for symptoms to begin diagnosis...
                    </div>
                </div>
            </div>
        </div>

        <!-- Diagnosis Results Panel -->
        <div class="panel" id="diagnosisPanel" style="display: none;">
            <div class="panel-header">
                <i class="fas fa-stethoscope"></i>
                <h2>Diagnosis Complete</h2>
            </div>
            
            <div class="diagnosis-result" id="diagnosisResult">
                <!-- Diagnosis results will be added here -->
            </div>
        </div>

        <footer>
            <p>AutoDiagnose Classic v1.0 | Expert System for Car Troubleshooting | Forward Chaining Inference Engine</p>
            <p style="margin-top: 5px; font-size: 0.8rem;">Â© 2024 Automotive Diagnostics AI Lab</p>
        </footer>
    </div>

    <!-- Symptom Selection Modal (hidden by default) -->
    <div id="symptomModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <h2 style="margin-bottom: 20px; color: var(--navy);">Select Symptoms</h2>
            <div id="availableSymptoms">
                <!-- Available symptoms will be loaded here -->
            </div>
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button class="btn-primary" id="addSymptomsBtn" style="flex: 1;">Add Selected Symptoms</button>
                <button class="btn-secondary" id="closeModalBtn" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Knowledge Base - Car Diagnostic Rules
        const diagnosticRules = [
            // Engine-related rules
            {
                id: 1,
                conditions: ['engine_wont_start', 'no_cranking_sound'],
                conclusion: 'dead_battery',
                confidence: 0.85,
                message: 'Dead battery likely - check battery voltage and connections'
            },
            {
                id: 2,
                conditions: ['engine_wont_start', 'cranking_sound', 'no_fuel_smell'],
                conclusion: 'fuel_system_issue',
                confidence: 0.75,
                message: 'Fuel system problem - check fuel pump, filter, and injectors'
            },
            {
                id: 3,
                conditions: ['engine_wont_start', 'cranking_sound', 'fuel_smell'],
                conclusion: 'ignition_system_issue',
                confidence: 0.80,
                message: 'Ignition system fault - check spark plugs, coils, and distributor'
            },
            {
                id: 4,
                conditions: ['engine_misfires', 'rough_idle'],
                conclusion: 'spark_plugs_fouled',
                confidence: 0.70,
                message: 'Fouled or worn spark plugs need replacement'
            },
            {
                id: 5,
                conditions: ['overheating', 'coolant_leak'],
                conclusion: 'cooling_system_leak',
                confidence: 0.90,
                message: 'Cooling system leak detected - check hoses, radiator, and water pump'
            },
            // Brake-related rules
            {
                id: 6,
                conditions: ['squealing_sound', 'braking'],
                conclusion: 'worn_brake_pads',
                confidence: 0.95,
                message: 'Brake pads are worn and need replacement'
            },
            {
                id: 7,
                conditions: ['grinding_sound', 'braking'],
                conclusion: 'worn_brake_rotors',
                confidence: 0.85,
                message: 'Brake rotors are worn - inspect and replace if necessary'
            },
            {
                id: 8,
                conditions: ['soft_brake_pedal', 'brake_warning_light'],
                conclusion: 'brake_fluid_leak',
                confidence: 0.80,
                message: 'Possible brake fluid leak - check master cylinder and lines'
            },
            // Electrical rules
            {
                id: 9,
                conditions: ['dim_lights', 'electrical_issues'],
                conclusion: 'alternator_problem',
                confidence: 0.75,
                message: 'Alternator may be failing - check charging system'
            },
            {
                id: 10,
                conditions: ['battery_warning_light', 'electrical_issues'],
                conclusion: 'charging_system_fault',
                confidence: 0.80,
                message: 'Charging system fault - test alternator and voltage regulator'
            },
            // Transmission rules
            {
                id: 11,
                conditions: ['delayed_shifting', 'transmission_slipping'],
                conclusion: 'low_transmission_fluid',
                confidence: 0.70,
                message: 'Low transmission fluid - check for leaks and fluid level'
            },
            {
                id: 12,
                conditions: ['burning_smell', 'transmission_slipping'],
                conclusion: 'overheating_transmission',
                confidence: 0.85,
                message: 'Transmission overheating - service needed immediately'
            },
            // General issues
            {
                id: 13,
                conditions: ['check_engine_light', 'poor_fuel_economy'],
                conclusion: 'oxygen_sensor_fault',
                confidence: 0.65,
                message: 'Oxygen sensor may be faulty - diagnostic scan recommended'
            },
            {
                id: 14,
                conditions: ['excessive_exhaust_smoke', 'blue_smoke'],
                conclusion: 'oil_burning',
                confidence: 0.90,
                message: 'Engine burning oil - check piston rings and valve seals'
            },
            {
                id: 15,
                conditions: ['excessive_exhaust_smoke', 'white_smoke'],
                conclusion: 'coolant_leak_internal',
                confidence: 0.85,
                message: 'Coolant leaking into combustion chamber - head gasket may be blown'
            }
        ];

        // Available symptoms for selection
        const availableSymptoms = [
            { id: 'engine_wont_start', label: 'Engine won\'t start' },
            { id: 'no_cranking_sound', label: 'No cranking sound when starting' },
            { id: 'cranking_sound', label: 'Engine cranks but won\'t start' },
            { id: 'fuel_smell', label: 'Smell of fuel when trying to start' },
            { id: 'engine_misfires', label: 'Engine misfires or runs rough' },
            { id: 'rough_idle', label: 'Rough idle or stalling' },
            { id: 'overheating', label: 'Engine overheating' },
            { id: 'coolant_leak', label: 'Visible coolant leak' },
            { id: 'squealing_sound', label: 'Squealing sound from brakes' },
            { id: 'grinding_sound', label: 'Grinding sound from brakes' },
            { id: 'braking', label: 'Sound occurs when braking' },
            { id: 'soft_brake_pedal', label: 'Soft or spongy brake pedal' },
            { id: 'brake_warning_light', label: 'Brake warning light illuminated' },
            { id: 'dim_lights', label: 'Dim headlights or interior lights' },
            { id: 'electrical_issues', label: 'Other electrical issues' },
            { id: 'battery_warning_light', label: 'Battery/charging warning light' },
            { id: 'delayed_shifting', label: 'Delayed or hard shifting' },
            { id: 'transmission_slipping', label: 'Transmission slipping' },
            { id: 'burning_smell', label: 'Burning smell from vehicle' },
            { id: 'check_engine_light', label: 'Check engine light is on' },
            { id: 'poor_fuel_economy', label: 'Poor fuel economy' },
            { id: 'excessive_exhaust_smoke', label: 'Excessive exhaust smoke' },
            { id: 'blue_smoke', label: 'Blue exhaust smoke' },
            { id: 'white_smoke', label: 'White exhaust smoke' }
        ];

        // Expert System State
        let selectedSymptoms = [];
        let inferredFacts = new Set();
        let triggeredRules = [];
        let inferenceComplete = false;

        // DOM Elements
        const symptomsList = document.getElementById('symptomsList');
        const inferenceLog = document.getElementById('inferenceLog');
        const diagnosisPanel = document.getElementById('diagnosisPanel');
        const diagnosisResult = document.getElementById('diagnosisResult');
        const inferenceLoading = document.getElementById('inferenceLoading');
        const symptomModal = document.getElementById('symptomModal');
        const availableSymptomsDiv = document.getElementById('availableSymptoms');

        // Initialize the system
        function initializeSystem() {
            updateSymptomsList();
            // Show symptom selection modal on first load
            setTimeout(() => {
                showSymptomModal();
            }, 500);
        }

        // Show symptom selection modal
        function showSymptomModal() {
            // Populate available symptoms
            availableSymptomsDiv.innerHTML = '';
            availableSymptoms.forEach(symptom => {
                const symptomDiv = document.createElement('div');
                symptomDiv.className = 'symptom-item';
                symptomDiv.innerHTML = `
                    <input type="checkbox" class="symptom-checkbox" id="sym_${symptom.id}" value="${symptom.id}">
                    <label class="symptom-label" for="sym_${symptom.id}">${symptom.label}</label>
                `;
                availableSymptomsDiv.appendChild(symptomDiv);
            });
            
            symptomModal.style.display = 'flex';
        }

        // Update the symptoms list display
        function updateSymptomsList() {
            symptomsList.innerHTML = '';
            
            if (selectedSymptoms.length === 0) {
                symptomsList.innerHTML = `
                    <div class="symptom-item" style="text-align: center; color: #777;">
                        <i class="fas fa-exclamation-circle"></i>
                        No symptoms selected. Click "Load Example" or add symptoms.
                    </div>
                `;
                return;
            }
            
            selectedSymptoms.forEach(symptomId => {
                const symptom = availableSymptoms.find(s => s.id === symptomId);
                if (symptom) {
                    const symptomDiv = document.createElement('div');
                    symptomDiv.className = 'symptom-item selected';
                    symptomDiv.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <span>${symptom.label}</span>
                    `;
                    symptomsList.appendChild(symptomDiv);
                }
            });
        }

        // Forward Chaining Inference Engine
        function runForwardChaining() {
            // Reset state
            inferredFacts = new Set([...selectedSymptoms]);
            triggeredRules = [];
            inferenceComplete = false;
            
            // Clear previous logs
            inferenceLog.innerHTML = '';
            
            // Show loading
            inferenceLoading.style.display = 'block';
            diagnosisPanel.style.display = 'none';
            
            // Add initial log entry
            addLogEntry('Inference Started', 'Beginning forward chaining with ' + selectedSymptoms.length + ' initial symptom(s)', 'step');
            
            // Add initial facts
            setTimeout(() => {
                addLogEntry('Initial Facts', 'Detected symptoms: ' + selectedSymptoms.map(id => {
                    const symptom = availableSymptoms.find(s => s.id === id);
                    return symptom ? symptom.label : id;
                }).join(', '), 'fact');
                
                // Run inference steps
                setTimeout(runInferenceSteps, 800);
            }, 800);
        }

        // Run inference steps
        function runInferenceSteps() {
            let newFactsAdded = true;
            let iteration = 0;
            
            while (newFactsAdded && iteration < 10) {
                newFactsAdded = false;
                iteration++;
                
                // Check each rule
                for (const rule of diagnosticRules) {
                    // Skip if rule already triggered
                    if (triggeredRules.includes(rule.id)) continue;
                    
                    // Check if all conditions are satisfied
                    const conditionsMet = rule.conditions.every(condition => 
                        inferredFacts.has(condition)
                    );
                    
                    if (conditionsMet) {
                        // Trigger the rule
                        triggeredRules.push(rule.id);
                        inferredFacts.add(rule.conclusion);
                        newFactsAdded = true;
                        
                        // Add to log
                        addLogEntry(`Rule ${rule.id} Triggered`, 
                                   `Conclusion: ${rule.message} (Confidence: ${Math.round(rule.confidence * 100)}%)`, 
                                   'fact');
                        
                        // Break to restart rule checking with new facts
                        break;
                    }
                }
            }
            
            // Inference complete
            setTimeout(() => {
                inferenceComplete = true;
                inferenceLoading.style.display = 'none';
                
                addLogEntry('Inference Complete', 
                           `Processed ${triggeredRules.length} rules, ${inferredFacts.size} total facts inferred<br>
                           Final facts: ${Array.from(inferredFacts).join(', ')}`, 
                           'complete');
                
                // Generate diagnosis
                setTimeout(generateDiagnosis, 1000);
            }, 1500);
        }

        // Add entry to inference log
        function addLogEntry(title, message, type = 'step') {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<strong>${title}</strong><br>${message}`;
            inferenceLog.appendChild(logEntry);
            inferenceLog.scrollTop = inferenceLog.scrollHeight;
        }

        // Generate diagnosis from inferred facts
        function generateDiagnosis() {
            diagnosisPanel.style.display = 'block';
            
            // Filter out the initial symptoms to get only conclusions
            const conclusions = Array.from(inferredFacts).filter(fact => 
                !selectedSymptoms.includes(fact) && 
                !availableSymptoms.some(s => s.id === fact)
            );
            
            if (conclusions.length === 0) {
                // No specific issues found
                diagnosisResult.innerHTML = `
                    <div class="diagnosis-header">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <div class="no-issue">No Specific Issues Found</div>
                            <p>The system could not identify specific problems based on the provided symptoms.</p>
                        </div>
                    </div>
                    <div class="recommendations">
                        <h3><i class="fas fa-tools"></i> Recommended Action</h3>
                        <ol>
                            <li>Check basic items: fuel level, battery connections, fuses</li>
                            <li>Consider professional diagnostic scan if symptoms persist</li>
                            <li>Review vehicle maintenance schedule</li>
                            <li>Try adding more specific symptoms for better diagnosis</li>
                            <li>Check for recalls or technical service bulletins for your vehicle</li>
                        </ol>
                    </div>
                `;
            } else {
                // Issues found - get the triggered rules
                const issues = triggeredRules.map(ruleId => {
                    return diagnosticRules.find(r => r.id === ruleId);
                });
                
                diagnosisResult.innerHTML = `
                    <div class="diagnosis-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <div class="issue-found">Potential Issues Identified</div>
                            <p>The expert system found ${issues.length} potential issue(s) based on your symptoms.</p>
                        </div>
                    </div>
                    <div class="diagnosis-content">
                        ${issues.map(rule => `
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <strong style="color: #3498db;">${rule.message}</strong><br>
                                <small>Confidence: ${Math.round(rule.confidence * 100)}% | Rule ID: ${rule.id}</small>
                            </div>
                        `).join('')}
                    </div>
                    <div class="recommendations">
                        <h3><i class="fas fa-tools"></i> Recommended Actions</h3>
                        <ol>
                            <li>Verify the symptoms match your vehicle's behavior</li>
                            <li>Check the most likely cause first (highest confidence)</li>
                            <li>Consult a professional mechanic for confirmation</li>
                            <li>Check repair costs and parts availability</li>
                            <li>Consider safety implications before driving</li>
                        </ol>
                    </div>
                `;
            }
            
            // Scroll to diagnosis
            diagnosisPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // Load example symptoms
        function loadExample() {
            selectedSymptoms = ['squealing_sound', 'braking'];
            updateSymptomsList();
            
            // Show confirmation
            addLogEntry('Example Loaded', 'Loaded example symptoms: Squealing sound from brakes, Sound occurs when braking', 'step');
        }

        // Event Listeners
        document.getElementById('startDiagnosisBtn').addEventListener('click', () => {
            if (selectedSymptoms.length === 0) {
                alert('Please select at least one symptom before starting diagnosis.');
                showSymptomModal();
                return;
            }
            runForwardChaining();
        });

        document.getElementById('clearAllBtn').addEventListener('click', () => {
            selectedSymptoms = [];
            inferredFacts.clear();
            triggeredRules = [];
            updateSymptomsList();
            inferenceLog.innerHTML = `
                <div class="log-entry complete">
                    <strong>System Reset</strong><br>
                    All symptoms and inference results cleared. Ready for new diagnosis.
                </div>
            `;
            diagnosisPanel.style.display = 'none';
        });

        document.getElementById('loadExampleBtn').addEventListener('click', loadExample);

        // Symptom modal buttons
        document.getElementById('addSymptomsBtn').addEventListener('click', () => {
            const checkboxes = document.querySelectorAll('.symptom-checkbox:checked');
            const newSymptoms = Array.from(checkboxes).map(cb => cb.value);
            
            // Add new symptoms (avoid duplicates)
            newSymptoms.forEach(symptom => {
                if (!selectedSymptoms.includes(symptom)) {
                    selectedSymptoms.push(symptom);
                }
            });
            
            updateSymptomsList();
            symptomModal.style.display = 'none';
            
            // Show confirmation
            if (newSymptoms.length > 0) {
                addLogEntry('Symptoms Added', `Added ${newSymptoms.length} symptom(s) to the diagnosis`, 'step');
            }
        });

        document.getElementById('closeModalBtn').addEventListener('click', () => {
            symptomModal.style.display = 'none';
        });

        // Add symptom selection button
        const addSymptomBtn = document.createElement('button');
        addSymptomBtn.className = 'btn-secondary';
        addSymptomBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Symptoms';
        addSymptomBtn.style.marginTop = '15px';
        addSymptomBtn.addEventListener('click', showSymptomModal);
        
        // Insert after control buttons
        const controlButtons = document.querySelector('.control-buttons');
        controlButtons.parentNode.insertBefore(addSymptomBtn, controlButtons.nextSibling);

        // Initialize the system
        initializeSystem();
    </script>
</body>
</html>
